{% extends "base.html" %}

{% block title %}PropertyHub - Temukan Rumah Impian Anda{% endblock %}

{% block content %}
  <!-- Hero Banner -->
  <section class="relative bg-gradient-to-br from-blue-900 via-blue-800 to-blue-600 text-white overflow-hidden">
    <!-- Background decoration -->
    <div class="absolute inset-0 opacity-10">
      <div class="absolute top-0 left-0 w-72 h-72 bg-white rounded-full -translate-x-1/2 -translate-y-1/2 mix-blend-soft-light"></div>
      <div class="absolute bottom-0 right-0 w-96 h-96 bg-white rounded-full translate-x-1/3 translate-y-1/3 mix-blend-soft-light"></div>
    </div>
    
    <div class="relative container mx-auto px-4 py-20 md:py-32">
      <div class="max-w-3xl">
        <!-- Trust badge -->
        <div class="inline-flex items-center px-4 py-2 rounded-full bg-white/20 backdrop-blur-sm text-sm font-medium mb-6">
          <span class="w-2 h-2 bg-yellow-400 rounded-full mr-2"></span>
          Platform Properti Terpercaya di Indonesia
        </div>
        
        <!-- Main heading -->
        <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">
          Temukan <span class="text-yellow-400">Rumah Impian</span> Anda dengan Mudah
        </h1>
        
        <!-- Subheading -->
        <p class="text-xl md:text-2xl mb-8 text-blue-100 max-w-2xl">
          Jelajahi koleksi properti premium dengan lokasi strategis, fasilitas lengkap, dan harga terbaik di seluruh Indonesia
        </p>
        
        <!-- CTA Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 mb-12">
          <button class="px-8 py-4 bg-yellow-500 hover:bg-yellow-600 text-white rounded-xl transition-all duration-300 font-semibold shadow-lg hover:shadow-xl flex items-center justify-center group">
            <i class="fas fa-search mr-3 group-hover:scale-110 transition-transform"></i>
            <span>Cari Properti Sekarang</span>
          </button>
          <button id="videoTourBtn" class="px-8 py-4 bg-white/10 backdrop-blur-sm border border-white/20 text-white rounded-xl hover:bg-white/20 transition duration-300 font-semibold flex items-center justify-center group">
            <i class="fas fa-play-circle mr-3 group-hover:scale-110 transition-transform"></i>
            <span>Lihat Video Tour</span>
          </button>
        </div>
        
        <!-- Trust indicators -->
        <div class="flex flex-wrap gap-6 text-white/80">
          <div class="flex items-center">
            <i class="fas fa-check-circle text-yellow-400 mr-2"></i>
            <span class="text-sm md:text-base">Verified Properties</span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-shield-alt text-yellow-400 mr-2"></i>
            <span class="text-sm md:text-base">Transaksi Aman</span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-headset text-yellow-400 mr-2"></i>
            <span class="text-sm md:text-base">Dukungan 24/7</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Wave Divider -->
    <div class="absolute bottom-0 left-0 right-0">
      <svg viewBox="0 0 1440 120" fill="none" class="w-full h-auto">
        <path d="M0,64L48,69.3C96,75,192,85,288,85.3C384,85,480,75,576,64C672,53,768,43,864,48C960,53,1056,75,1152,80C1248,85,1344,75,1392,69.3L1440,64V120H1392C1344,120,1248,120,1152,120C1056,120,960,120,864,120C768,120,672,120,576,120C480,120,384,120,288,120C192,120,96,120,48,120H0V64Z" fill="#f9fafb"/>
      </svg>
    </div>
  </section>

  <!-- Search & Filter -->
  <section class="bg-gray-50 py-8 -mb-8">
    <div class="container mx-auto px-4">
      <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 -mt-16 relative z-10">
        <!-- Section header -->
        <div class="mb-6">
          <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">Temukan Properti Ideal Anda</h2>
          <p class="text-gray-600">Filter berdasarkan preferensi untuk menemukan properti yang sesuai</p>
        </div>
        
        <!-- Filter grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
          <!-- Location filter -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Lokasi</label>
            <select id="filterLokasi" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white appearance-none bg-[url('data:image/svg+xml;charset=US-ASCII,<svg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%204%205%22%3E%3Cpath%20fill%3D%22%23666%22%20d%3D%22M2%200L0%202h4zm0%205L0%203h4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-right-0.5rem bg-center bg-[length:1rem]">
              <option>Pilih Lokasi</option>
              <option>Jakarta Selatan</option>
              <option>Jakarta Pusat</option>
              <option>Tangerang</option>
              <option>Bekasi</option>
              <option>Bandung</option>
              <option>Surabaya</option>
            </select>
          </div>
          
          <!-- Property type filter -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Tipe Properti</label>
            <select id="filterTipe" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white appearance-none bg-[url('data:image/svg+xml;charset=US-ASCII,<svg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%204%205%22%3E%3Cpath%20fill%3D%22%23666%22%20d%3D%22M2%200L0%202h4zm0%205L0%203h4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-right-0.5rem bg-center bg-[length:1rem]">
              <option>Semua Tipe</option>
              <option>Rumah</option>
              <option>Apartemen</option>
              <option>Townhouse</option>
              <option>Villa</option>
              <option>Ruko</option>
            </select>
          </div>
          
          <!-- Price range filter -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Rentang Harga</label>
            <select id="filterHarga" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white appearance-none bg-[url('data:image/svg+xml;charset=US-ASCII,<svg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%204%205%22%3E%3Cpath%20fill%3D%22%23666%22%20d%3D%22M2%200L0%202h4zm0%205L0%203h4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-right-0.5rem bg-center bg-[length:1rem]">
              <option>Semua Harga</option>
              <option>&lt; 1 Miliar</option>
              <option>1-3 Miliar</option>
              <option>3-5 Miliar</option>
              <option>5-10 Miliar</option>
              <option>&gt; 10 Miliar</option>
            </select>
          </div>
          
          <!-- Bedrooms filter -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Kamar Tidur</label>
            <select id="filterKamar" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white appearance-none bg-[url('data:image/svg+xml;charset=US-ASCII,<svg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%204%205%22%3E%3Cpath%20fill%3D%22%23666%22%20d%3D%22M2%200L0%202h4zm0%205L0%203h4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-right-0.5rem bg-center bg-[length:1rem]">
              <option>Semua</option>
              <option>1 Kamar</option>
              <option>2 Kamar</option>
              <option>3 Kamar</option>
              <option>4+ Kamar</option>
            </select>
          </div>
          
          <!-- Search button -->
          <div class="flex items-end">
            <button id="btnFilter" class="w-full px-6 py-3.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition duration-300 font-semibold shadow-md hover:shadow-lg flex items-center justify-center group">
              <i class="fas fa-search mr-2 group-hover:scale-110 transition-transform"></i>
              <span>Cari</span>
            </button>
          </div>
        </div>
        
        <!-- Filter footer -->
        <div class="flex justify-between items-center pt-4 border-t border-gray-200">
          <div class="text-sm text-gray-500">
            Menampilkan <span id="propertyCount" class="font-semibold text-gray-700">{{ properties|length }}</span> properti
          </div>
          <button class="text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center group">
            <i class="fas fa-sliders-h mr-2 group-hover:rotate-90 transition-transform"></i>
            Filter Lanjutan
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Property Listings -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <!-- Section header -->
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4 relative inline-block">
          Properti Unggulan
          <span class="absolute bottom-0 left-0 w-1/2 h-1 bg-yellow-400 rounded-full -mb-2"></span>
        </h2>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto mt-6">
          Temukan pilihan properti terbaik dengan lokasi strategis, fasilitas lengkap, dan harga kompetitif
        </p>
      </div>

      <!-- Property grid -->
      <div id="propertyGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>

      <!-- Load more button -->
      <div class="text-center mt-12">
        <button class="px-8 py-3.5 border-2 border-blue-600 text-blue-600 rounded-lg hover:bg-blue-600 hover:text-white transition duration-300 font-semibold flex items-center mx-auto group">
          <span>Lihat Semua Properti</span>
          <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
        </button>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="py-16 bg-gradient-to-r from-blue-600 to-blue-800 text-white">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
        <div class="animate-fade-in">
          <div class="text-4xl md:text-5xl font-bold mb-2">500+</div>
          <div class="text-blue-200 font-medium">Properti Tersedia</div>
        </div>
        <div class="animate-fade-in" style="animation-delay: 100ms">
          <div class="text-4xl md:text-5xl font-bold mb-2">250+</div>
          <div class="text-blue-200 font-medium">Klien Puas</div>
        </div>
        <div class="animate-fade-in" style="animation-delay: 200ms">
          <div class="text-4xl md:text-5xl font-bold mb-2">15+</div>
          <div class="text-blue-200 font-medium">Tahun Pengalaman</div>
        </div>
        <div class="animate-fade-in" style="animation-delay: 300ms">
          <div class="text-4xl md:text-5xl font-bold mb-2">50+</div>
          <div class="text-blue-200 font-medium">Agen Profesional</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Why Choose Us Section -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4 relative inline-block">
          Mengapa Memilih PropertyHub?
          <span class="absolute bottom-0 left-0 w-1/2 h-1 bg-yellow-400 rounded-full -mb-2"></span>
        </h2>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto mt-6">
          Kami memberikan pengalaman terbaik dalam mencari dan memiliki properti impian Anda
        </p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Feature 1 -->
        <div class="bg-gray-50 rounded-xl p-6 text-center hover:shadow-lg transition duration-300 group hover:transform hover:-translate-y-2">
          <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
            <i class="fas fa-shield-alt text-white text-2xl"></i>
          </div>
          <h3 class="text-xl font-bold text-gray-800 mb-3">Transaksi Aman</h3>
          <p class="text-gray-600">Proses transaksi yang terjamin keamanannya dengan sistem pembayaran yang terpercaya.</p>
        </div>
        
        <!-- Feature 2 -->
        <div class="bg-gray-50 rounded-xl p-6 text-center hover:shadow-lg transition duration-300 group hover:transform hover:-translate-y-2">
          <div class="w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
            <i class="fas fa-search text-white text-2xl"></i>
          </div>
          <h3 class="text-xl font-bold text-gray-800 mb-3">Properti Terverifikasi</h3>
          <p class="text-gray-600">Semua properti telah melalui proses verifikasi untuk memastikan kualitas dan legalitas.</p>
        </div>
        
        <!-- Feature 3 -->
        <div class="bg-gray-50 rounded-xl p-6 text-center hover:shadow-lg transition duration-300 group hover:transform hover:-translate-y-2">
          <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
            <i class="fas fa-headset text-white text-2xl"></i>
          </div>
          <h3 class="text-xl font-bold text-gray-800 mb-3">Dukungan 24/7</h3>
          <p class="text-gray-600">Tim customer service siap membantu Anda kapan saja dengan respon yang cepat.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Video Modal -->
  <div id="videoModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 backdrop-blur-sm p-4 md:p-6">
    <div class="max-w-4xl w-full mx-auto">
      <div class="bg-white rounded-2xl shadow-2xl relative overflow-hidden">
        <!-- Close button -->
        <button id="closeVideoBtn" class="absolute -top-12 right-0 z-50 bg-white/10 text-white rounded-full p-2 hover:bg-white/20 transition duration-200">
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>

        <!-- Video container -->
        <div class="w-full bg-black rounded-t-2xl overflow-hidden aspect-video">
          <video id="tourVideo" class="w-full h-full object-contain" controls playsinline>
            <source src="https://www.youtube.com/watch?v=gpHLhjkMR0E" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
        
        <!-- Video info -->
        <div class="p-6 bg-white">
          <h3 class="text-xl font-bold text-gray-800 mb-2">Virtual Tour PropertyHub</h3>
          <p class="text-gray-600">Lihat pengalaman lengkap menggunakan platform PropertyHub untuk menemukan properti impian Anda</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating contact button -->
  <button id="btnContact" class="fixed right-6 bottom-6 z-40 flex items-center gap-3 bg-green-600 hover:bg-green-700 text-white px-5 py-4 rounded-full shadow-lg transition duration-300 animate-bounce hover:animate-none">
    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
      <path d="M20.52 3.48A11.95 11.95 0 0012 0C5.373 0 0 5.373 0 12c0 2.115.554 4.09 1.61 5.86L0 24l6.39-1.61A11.94 11.94 0 0012 24c6.627 0 12-5.373 12-12 0-3.21-1.25-6.19-3.48-8.52zM12 21.6a9.6 9.6 0 01-5.14-1.43l-.36-.21-3.8.96.99-3.7-.23-.37A9.6 9.6 0 1121.6 12 9.6 9.6 0 0112 21.6z"/>
      <path d="M17.22 14.05l-1.29-.37a1 1 0 00-1.02.28l-.66.71a8.44 8.44 0 01-3.96-3.95l.7-.66a1 1 0 00.28-1.02l-.37-1.29A1 1 0 009.6 6.6L8.1 7.05a3 3 0 00-1.03 4.2l.55.77a11.43 11.43 0 005.88 5.88l.77.55a3 3 0 004.2-1.03l.45-1.5a1 1 0 00-.9-1.87z"/>
    </svg>
    <span class="font-medium">Hubungi Kami</span>
  </button>

  <!-- Contact Modal -->
  <div id="contactModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 backdrop-blur-sm p-4">
    <div class="w-full max-w-md mx-auto">
      <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
        <!-- Header -->
        <div class="bg-blue-600 p-6 text-white">
          <div class="flex items-center justify-between">
            <h3 class="text-xl font-bold">Hubungi Kami</h3>
            <button id="closeContact" class="text-white hover:text-gray-200 p-1 rounded-md transition duration-200">
              <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
          <p class="text-blue-100 mt-2">Tim kami siap membantu Anda menemukan properti impian</p>
        </div>

        <!-- Content -->
        <div class="p-6 space-y-6">
          <!-- WhatsApp info -->
          <div class="flex items-center gap-4 p-4 bg-green-50 rounded-lg border border-green-100">
            <div class="bg-green-600 rounded-full w-12 h-12 flex items-center justify-center flex-shrink-0">
              <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.52 3.48A11.95 11.95 0 0012 0C5.373 0 0 5.373 0 12c0 2.115.554 4.09 1.61 5.86L0 24l6.39-1.61A11.94 11.94 0 0012 24c6.627 0 12-5.373 12-12 0-3.21-1.25-6.19-3.48-8.52zM12 21.6a9.6 9.6 0 01-5.14-1.43l-.36-.21-3.8.96.99-3.7-.23-.37A9.6 9.6 0 1121.6 12 9.6 9.6 0 0112 21.6z"/>
                <path d="M17.22 14.05l-1.29-.37a1 1 0 00-1.02.28l-.66.71a8.44 8.44 0 01-3.96-3.95l.7-.66a1 1 0 00.28-1.02l-.37-1.29A1 1 0 009.6 6.6L8.1 7.05a3 3 0 00-1.03 4.2l.55.77a11.43 11.43 0 005.88 5.88l.77.55a3 3 0 004.2-1.03l.45-1.5a1 1 0 00-.9-1.87z"/>
              </svg>
            </div>

            <div>
              <p class="text-sm text-gray-700">Chat dengan tim support kami via WhatsApp</p>
              <p class="text-sm font-medium text-gray-900">+62 895-3965-7895</p>
            </div>
          </div>

          <!-- Action buttons -->
          <div class="flex gap-3">
            <a id="waLink" href="https://wa.me/62895396578951?text=Halo%20saya%20ingin%20bertanya%20tentang%20properti" target="_blank" rel="noopener noreferrer" class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition duration-300 group">
              <svg class="w-5 h-5 group-hover:scale-110 transition-transform" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.52 3.48A11.95 11.95 0 0012 0C5.373 0 0 5.373 0 12c0 2.115.554 4.09 1.61 5.86L0 24l6.39-1.61A11.94 11.94 0 0012 24c6.627 0 12-5.373 12-12 0-3.21-1.25-6.19-3.48-8.52zM12 21.6a9.6 9.6 0 01-5.14-1.43l-.36-.21-3.8.96.99-3.7-.23-.37A9.6 9.6 0 1121.6 12 9.6 9.6 0 0112 21.6z"/>
                <path d="M17.22 14.05l-1.29-.37a1 1 0 00-1.02.28l-.66.71a8.44 8.44 0 01-3.96-3.95l.7-.66a1 1 0 00.28-1.02l-.37-1.29A1 1 0 009.6 6.6L8.1 7.05a3 3 0 00-1.03 4.2l.55.77a11.43 11.43 0 005.88 5.88l.77.55a3 3 0 004.2-1.03l.45-1.5a1 1 0 00-.9-1.87z"/>
              </svg>
              Chat Sekarang
            </a>

            <button id="closeContact2" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition duration-300">Tutup</button>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  // Ambil data dari backend (Flask)
  const properties = JSON.parse('{{ data_json | safe }}');
  
  function generatePropertyCards(list) {
    const grid = document.getElementById("propertyGrid");
    grid.innerHTML = "";

    // Update property count
    document.getElementById("propertyCount").textContent = list.length;

    if (list.length === 0) {
      grid.innerHTML = `
        <div class="col-span-full text-center py-12">
          <div class="w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
            <i class="fas fa-home text-gray-400 text-3xl"></i>
          </div>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">Tidak ada properti yang sesuai</h3>
          <p class="text-gray-500">Coba ubah filter pencarian Anda</p>
        </div>
      `;
      return;
    }

    list.forEach(p => {
      const card = document.createElement("div");
      card.className = "bg-white rounded-2xl shadow-lg overflow-hidden group hover:shadow-2xl transition-all duration-300 hover:-translate-y-2";
      
      // Determine status badge
      let statusBadge = '';
      if (p.featured) {
        statusBadge = '<div class="absolute top-4 left-4 z-10 bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-semibold">Featured</div>';
      } else if (p.status === 'sold') {
        statusBadge = '<div class="absolute top-4 left-4 z-10 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold">Terjual</div>';
      } else {
        statusBadge = '<div class="absolute top-4 left-4 z-10 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold">Tersedia</div>';
      }
      
      card.innerHTML = `
        <div class="relative overflow-hidden">
          <div class="aspect-w-16 aspect-h-10 overflow-hidden">
            <img src="data:image/jpeg;base64,${p.image_properties}" alt="${p.nama_properti}" class="w-full h-64 object-cover group-hover:scale-110 transition-transform duration-500">
          </div>
          ${statusBadge}
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition duration-300"></div>
        </div>
        <div class="p-6">
          <div class="flex justify-between items-start mb-2">
            <h3 class="text-xl font-bold text-gray-800 group-hover:text-blue-600 transition duration-300">${p.nama_properti}</h3>
            <span class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">${p.tipe_properti}</span>
          </div>
          
          <div class="flex items-center text-gray-600 mb-3">
            <i class="fas fa-map-marker-alt text-blue-600 mr-2"></i>
            <span class="text-sm">${p.alamat_properti}</span>
          </div>
          
          <div class="grid grid-cols-2 gap-2 mb-4 text-sm text-gray-600">
            <div class="flex items-center">
              <i class="fas fa-expand-arrows-alt mr-2 text-blue-600"></i>
              <span>${p.besar_properti} mÂ²</span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-arrows-alt-h mr-2 text-blue-600"></i>
              <span>${p.lebar_properti} m</span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-bed mr-2 text-blue-600"></i>
              <span>${p.jumlah_kamar || 'N/A'} Kamar</span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-bath mr-2 text-blue-600"></i>
              <span>${p.jumlah_kamar_mandi || 'N/A'} Kamar Mandi</span>
            </div>
          </div>
          
          <p class="text-gray-700 text-sm mb-4 line-clamp-2">${p.deskripsi_properti}</p>
          
          <div class="flex items-center justify-between pt-4 border-t border-gray-100">
            <div class="text-2xl font-bold text-blue-600">Rp ${Number(p.harga).toLocaleString('id-ID')}</div>
            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition duration-300 group">
              <span class="group-hover:scale-105 transition-transform">Detail</span>
            </button>
          </div>
        </div>
      `;
      grid.appendChild(card);
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    generatePropertyCards(properties);

    document.getElementById("btnFilter").addEventListener("click", () => {
      const lokasi = document.getElementById("filterLokasi").value;
      const tipe = document.getElementById("filterTipe").value;
      const harga = document.getElementById("filterHarga").value;
      const kamar = document.getElementById("filterKamar").value;

      const filtered = properties.filter(p => {
        let ok = true;

        // Lokasi
        if (lokasi && lokasi !== "Pilih Lokasi" && !p.alamat_properti.includes(lokasi)) ok = false;

        // Tipe
        if (tipe && tipe !== "Semua Tipe" && p.tipe_properti !== tipe) ok = false;

        // Harga
        if (harga && harga !== "Semua Harga") {
          const h = Number(p.harga)/1000000000; // harga dalam miliar
          if (harga === "< 1 Miliar" && h >= 1) ok = false;
          if (harga === "1-3 Miliar" && (h < 1 || h > 3)) ok = false;
          if (harga === "3-5 Miliar" && (h < 3 || h > 5)) ok = false;
          if (harga === "5-10 Miliar" && (h < 5 || h > 10)) ok = false;
          if (harga === "> 10 Miliar" && h <= 10) ok = false;
        }

        // Kamar
        const k = p.jumlah_kamar || 0;
        if (kamar && kamar !== "Semua") {
          if (kamar === "4+ Kamar" && k < 4) ok = false;
          else if (kamar !== "4+ Kamar") {
            const kamarNum = parseInt(kamar);
            if (k !== kamarNum) ok = false;
          }
        }

        return ok;
      });

      generatePropertyCards(filtered);
    });
    
    // Update property count on page load
    document.getElementById("propertyCount").textContent = properties.length;
  });

  // Video Modal Functionality
  (function() {
    const btn = document.getElementById('videoTourBtn');
    const modal = document.getElementById('videoModal');
    const closeBtn = document.getElementById('closeVideoBtn');
    const video = document.getElementById('tourVideo');

    if (!btn || !modal || !video) return;

    function openModal() {
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      document.documentElement.style.overflow = 'hidden';
      try { 
        video.currentTime = 0; 
        video.play(); 
      } catch(e){ 
        console.warn('Could not play video:', e); 
      }
    }

    function closeModal() {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
      try { 
        video.pause(); 
        video.currentTime = 0; 
      } catch(e){}
      document.documentElement.style.overflow = '';
    }

    btn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);

    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) closeModal();
    });
  })();

  // Contact Modal Functionality
  (function(){
    const btn = document.getElementById('btnContact');
    const modal = document.getElementById('contactModal');
    const closePrimary = document.getElementById('closeContact');
    const closeSecondary = document.getElementById('closeContact2');

    if (!btn || !modal) return console.warn('Contact modal elements not found');

    function openModal(){
      modal.classList.remove('hidden'); 
      modal.classList.add('flex');
      document.documentElement.style.overflow = 'hidden';
    }
    
    function closeModal(){
      modal.classList.add('hidden'); 
      modal.classList.remove('flex');
      document.documentElement.style.overflow = '';
    }

    btn.addEventListener('click', openModal);
    if (closePrimary) closePrimary.addEventListener('click', closeModal);
    if (closeSecondary) closeSecondary.addEventListener('click', closeModal);

    modal.addEventListener('click', (e) => { 
      if (e.target === modal) closeModal(); 
    });
    
    document.addEventListener('keydown', (e) => { 
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) closeModal(); 
    });
  })();
</script>

<style>
  /* Custom animations */
  @keyframes fade-in {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .animate-fade-in {
    animation: fade-in 0.6s ease-out both;
  }
  
  /* Line clamp utility */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
   /* background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
  
  /* Custom select arrow */
  select {
    background-position: right 0.5rem center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }
</style>
{% endblock %}